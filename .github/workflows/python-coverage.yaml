# https://github.com/marketplace/actions/python-coverage

name: python-coverage

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

permissions:
  pull-requests: write

jobs:
  container-coverage-test:
    runs-on: [self-hosted, docker]
    container:
      image: localhost:5000/flag-gems-ci:v1.0
      ports:
        - 81
      options: --gpus all --hostname flag-gems_cicd_coverage
    steps:

      - name: check-gpu-free
        run: tools/gpu_check.sh

      - name: run-pytest
        shell: bash
        run: bash tools/code_coverage/coverage.sh ${{ github.event.pull_request.number }}
