# https://github.com/marketplace/actions/python-coverage

name: python-coverage

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]
  workflow_run:
    workflows: ["op-unit-test"]
    types:
      - completed

jobs:
  container-coverage-test:
    runs-on: [self-hosted, docker]
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    container:
      image: localhost:5000/flag-gems-ci:v1.0
      ports:
        - 81
      options: --gpus all --hostname flag-gems_cicd_coverage
    steps:

      - name: check-gpu-free
        shell: bash
        run: tools/gpu_check.sh

      - name: run-pytest
        shell: bash
        run: tools/code_coverage/coverage.sh 168 #${{ github.event.pull_request.number }}
